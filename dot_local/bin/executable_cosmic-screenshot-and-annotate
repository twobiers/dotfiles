#!/bin/bash
set -euo pipefail

FILENAME=$(cosmic-screenshot --interactive=true --notify=false)
if [ $? -ne 0 ]; then
    echo "Failed to take screenshot with cosmic-screenshot tool"
    exit 1
fi

if [ -z "$FILENAME" ]; then
    FILENAME="/tmp/screenshot.png"
    sleep 0.5
    wl-paste --type image/png > /tmp/screenshot.png
    if [ $? -ne 0 ]; then
        echo "Failed to get screenshot from clipboard"
        exit 1
    fi
fi

trap 'rm -f "$FILENAME"' EXIT

# QT_AUTO_SCREEN_SCALE_FACTOR=0 QT_SCALE_FACTOR=1 ksnip "$FILENAME"
com.github.phase1geo.annotator -i < "$FILENAME"
# QT_QPA_PLATFORM=xcb QT_AUTO_SCREEN_SCALE_FACTOR=1 ksnip "$FILENAME"

if [ $? -ne 0 ]; then
    echo "Failed to open screenshot with Annotator tool"
    exit 1
fi